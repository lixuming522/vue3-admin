version: 1.0

stages:
  - build

build_job:
  stage: build
  script:
    # Step 1: 安装 nvm
    - curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash

    # Step 2: 加载 nvm
    - export NVM_DIR="$HOME/.nvm"
    - source "$NVM_DIR/nvm.sh"

    # Step 3: 安装并使用 Node.js 18
    - nvm install 18
    - nvm use 18
    - node -v
    - npm -v

    # Step 4: 安装依赖（跳过脚本避免 husky 报错）
    - npm config set ignore-scripts true
    - npm install --legacy-peer-deps

    # Step 5: 构建项目
    - npm run build

  only:
    - master