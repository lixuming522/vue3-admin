import{t as e,z as a,v as l,aT as s,aW as r,_ as t,d as i,b as o,r as d,c as n,L as u,J as m,I as c,g as p,f,e as v,l as b,k as y,i as _,w as g,D as w,E as k,n as j,q as h,S as V,o as P,m as C,aX as x,C as E,aY as z,F as q,aq as U,a0 as I,h as A,aD as S}from"./index.C0po-9Cw.js";import{E as F}from"./dialog.BbnCETTc.js";import"./overlay.CmIwStbv.js";import{E as Z,a as R}from"./form-item.Cae-w8St.js";import{_ as $}from"./index.vue_vue_type_script_setup_true_lang.CyY9v1bp.js";import{E as M}from"./input.DpcieQl7.js";import{E as N,a as O}from"./col.Ce50RrY6.js";import{E as B,a as T}from"./descriptions-item.DHGPKwGX.js";import{E as D}from"./card.BFLE0G2e.js";import{E as L}from"./divider.B6RWD1Z3.js";import{E as W}from"./button.DFhZv67P.js";import{F as X}from"./file.api.BxTGHtPp.js";import{_ as Y}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./index.CejFaZzz.js";import"./refs.DbmmvE6g.js";import"./index.DEBXCisX.js";import"./vnode.OFmkjKtN.js";import"./event.BwRzfsZt.js";import"./error.CWZe14OZ.js";import"./scroll.CyW--hcd.js";import"./use-form-common-props.CYevFZY7.js";import"./popper.qO4aM_EK.js";import"./index.KNAo7tSx.js";import"./castArray.CzduHbdn.js";import"./_Uint8Array.Bk5ZUc8x.js";import"./_initCloneObject.C9TnfYHj.js";import"./checkbox.BOanOKbe.js";import"./isEqual.DlKuNc3H.js";import"./radio-group.BKSYoxq3.js";/* empty css              *//* empty css            */import"./select.BwM-Dqgp.js";import"./scrollbar.BTs67JqR.js";import"./index.DEYphu4p.js";import"./token.DWNpOE8r.js";import"./strings.BtpqUw1f.js";import"./index.DQZtczPz.js";import"./debounce.Zxog9LHJ.js";import"./_baseIteratee.DmEO8XJz.js";import"./index.CCM7hegp.js";import"./index.DsIqZBX6.js";const J=e({size:{type:[Number,String],values:r,default:"",validator:e=>s(e)},shape:{type:String,values:["circle","square"],default:"circle"},icon:{type:l},src:{type:String,default:""},alt:String,srcSet:String,fit:{type:a(String),default:"cover"}}),K={error:e=>e instanceof Event},G=i({name:"ElAvatar"});const H=h(t(i({...G,props:J,emits:K,setup(e,{emit:a}){const l=e,r=o("avatar"),t=d(!1),i=n((()=>{const{size:e,icon:a,shape:s}=l,t=[r.b()];return u(e)&&t.push(r.m(e)),a&&t.push(r.m("icon")),s&&t.push(r.m(s)),t})),h=n((()=>{const{size:e}=l;return s(e)?r.cssVarBlock({size:m(e)||""}):void 0})),V=n((()=>({objectFit:l.fit})));function P(e){t.value=!0,a("error",e)}return c((()=>l.src),(()=>t.value=!1)),(e,a)=>(f(),p("span",{class:j(_(i)),style:y(_(h))},[!e.src&&!e.srcSet||t.value?e.icon?(f(),v(_(k),{key:1},{default:g((()=>[(f(),v(w(e.icon)))])),_:1})):b(e.$slots,"default",{key:2}):(f(),p("img",{key:0,src:e.src,alt:e.alt,srcset:e.srcSet,style:y(_(V)),onError:P},null,44,["src","alt","srcset"]))],6))}}),[["__file","avatar.vue"]])),Q={class:"profile-container"},ee={class:"user-info"},ae={class:"avatar-wrapper"},le={class:"user-name"},se={class:"nickname"},re={class:"user-role"},te={class:"security-item"},ie={class:"dialog-footer"},oe=Y(i({__name:"index",setup(e){const a=d({}),l=V({visible:!1,title:"",type:""}),s=V({}),r=V({}),t=V({}),i=V({}),o=d(0),n=d(),u=d(0),m=d(),c={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"}]},b={mobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}]},y={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{pattern:/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/,message:"请输入正确的邮箱地址",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}]},w=e=>{switch(l.type=e,l.visible=!0,e){case"account":l.title="账号资料",s.id=a.value.id,s.nickname=a.value.nickname,s.gender=a.value.gender;break;case"password":l.title="修改密码";break;case"mobile":l.title="绑定手机";break;case"email":l.title="绑定邮箱"}};function j(){if(!t.mobile)return void S.error("请输入手机号");/^1[3-9]\d{9}$/.test(t.mobile)?x.sendMobileCode(t.mobile).then((()=>{S.success("验证码发送成功"),o.value=60,n.value=setInterval((()=>{o.value>0?o.value-=1:clearInterval(n.value)}),1e3)})):S.error("手机号格式不正确")}function h(){if(!i.email)return void S.error("请输入邮箱");/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/.test(i.email)?x.sendEmailCode(i.email).then((()=>{S.success("验证码发送成功"),u.value=60,m.value=setInterval((()=>{u.value>0?u.value-=1:clearInterval(m.value)}),1e3)})):S.error("邮箱格式不正确")}const Y=async()=>{if("account"===l.type)x.updateProfile(s).then((()=>{S.success("账号资料修改成功"),l.visible=!1,oe()}));else if("password"===l.type){if(r.newPassword!==r.confirmPassword)return void S.error("两次输入的密码不一致");x.changePassword(r).then((()=>{S.success("密码修改成功"),l.visible=!1}))}else"mobile"===l.type?x.bindOrChangeMobile(t).then((()=>{S.success("手机号绑定成功"),l.visible=!1,oe()})):"email"===l.type&&x.bindOrChangeEmail(i).then((()=>{S.success("邮箱绑定成功"),l.visible=!1,oe()}))},J=d(null),K=()=>{var e;null==(e=J.value)||e.click()},G=async e=>{const l=e.target,s=l.files?l.files[0]:null;if(s)try{const e=await X.uploadFile(s);a.value.avatar=e.url,await x.updateProfile({avatar:e.url})}catch(r){S.error("头像上传失败")}},oe=async()=>{const e=await x.getProfile();a.value=e};return P((async()=>{n.value&&clearInterval(n.value),m.value&&clearInterval(m.value),await oe()})),(e,d)=>{const n=H,m=W,V=U("Edit"),P=k,x=L,S=D,X=O,oe=U("Male"),de=U("Female"),ne=T,ue=B,me=N,ce=M,pe=Z,fe=$,ve=R,be=F;return f(),p("div",Q,[C(me,{gutter:20},{default:g((()=>[C(X,{span:8},{default:g((()=>[C(S,{class:"user-card"},{default:g((()=>[E("div",ee,[E("div",ae,[C(n,{src:_(a).avatar,size:100},null,8,["src"]),C(m,{type:"info",class:"avatar-edit-btn",circle:"",icon:_(z),size:"small",onClick:K},null,8,["icon"]),E("input",{ref_key:"fileInput",ref:J,type:"file",style:{display:"none"},onChange:G},null,544)]),E("div",le,[E("span",se,q(_(a).nickname),1),C(P,{class:"edit-icon",onClick:d[0]||(d[0]=e=>w("account"))},{default:g((()=>[C(V)])),_:1})]),E("div",re,q(_(a).roleNames),1)]),C(x),d[17]||(d[17]=E("div",{class:"user-stats"},[E("div",{class:"stat-item"},[E("div",{class:"stat-value"},"0"),E("div",{class:"stat-label"},"待办")]),E("div",{class:"stat-item"},[E("div",{class:"stat-value"},"0"),E("div",{class:"stat-label"},"消息")]),E("div",{class:"stat-item"},[E("div",{class:"stat-value"},"0"),E("div",{class:"stat-label"},"通知")])],-1))])),_:1})])),_:1}),C(X,{span:16},{default:g((()=>[C(S,{class:"info-card"},{header:g((()=>d[18]||(d[18]=[E("div",{class:"card-header"},[E("span",null,"账号信息")],-1)]))),default:g((()=>[C(ue,{column:1,border:""},{default:g((()=>[C(ne,{label:"用户名"},{default:g((()=>[I(q(_(a).username)+" ",1),1===_(a).gender?(f(),v(P,{key:0,class:"gender-icon male"},{default:g((()=>[C(oe)])),_:1})):(f(),v(P,{key:1,class:"gender-icon female"},{default:g((()=>[C(de)])),_:1}))])),_:1}),C(ne,{label:"手机号码"},{default:g((()=>[I(q(_(a).mobile||"未绑定")+" ",1),_(a).mobile?(f(),v(m,{key:0,type:"primary",link:"",onClick:d[1]||(d[1]=()=>w("mobile"))},{default:g((()=>d[19]||(d[19]=[I(" 更换 ")]))),_:1})):(f(),v(m,{key:1,type:"primary",link:"",onClick:d[2]||(d[2]=()=>w("mobile"))},{default:g((()=>d[20]||(d[20]=[I(" 绑定 ")]))),_:1}))])),_:1}),C(ne,{label:"邮箱"},{default:g((()=>[I(q(_(a).email||"未绑定")+" ",1),_(a).email?(f(),v(m,{key:0,type:"primary",link:"",onClick:d[3]||(d[3]=()=>w("email"))},{default:g((()=>d[21]||(d[21]=[I(" 更换 ")]))),_:1})):(f(),v(m,{key:1,type:"primary",link:"",onClick:d[4]||(d[4]=()=>w("email"))},{default:g((()=>d[22]||(d[22]=[I(" 绑定 ")]))),_:1}))])),_:1}),C(ne,{label:"部门"},{default:g((()=>[I(q(_(a).deptName),1)])),_:1}),C(ne,{label:"创建时间"},{default:g((()=>[I(q(_(a).createTime),1)])),_:1})])),_:1})])),_:1}),C(S,{class:"security-card"},{header:g((()=>d[23]||(d[23]=[E("div",{class:"card-header"},[E("span",null,"安全设置")],-1)]))),default:g((()=>[E("div",te,[d[25]||(d[25]=E("div",{class:"security-info"},[E("div",{class:"security-title"},"账户密码"),E("div",{class:"security-desc"},"定期修改密码有助于保护账户安全")],-1)),C(m,{type:"primary",link:"",onClick:d[5]||(d[5]=()=>w("password"))},{default:g((()=>d[24]||(d[24]=[I(" 修改 ")]))),_:1})])])),_:1})])),_:1})])),_:1}),C(be,{modelValue:_(l).visible,"onUpdate:modelValue":d[16]||(d[16]=e=>_(l).visible=e),title:_(l).title,width:500},{footer:g((()=>[E("span",ie,[C(m,{onClick:d[15]||(d[15]=e=>_(l).visible=!1)},{default:g((()=>d[26]||(d[26]=[I("取消")]))),_:1}),C(m,{type:"primary",onClick:Y},{default:g((()=>d[27]||(d[27]=[I("确定")]))),_:1})])])),default:g((()=>["account"===_(l).type?(f(),v(ve,{key:0,ref:"userProfileFormRef",model:_(s),"label-width":100},{default:g((()=>[C(pe,{label:"昵称"},{default:g((()=>[C(ce,{modelValue:_(s).nickname,"onUpdate:modelValue":d[6]||(d[6]=e=>_(s).nickname=e)},null,8,["modelValue"])])),_:1}),C(pe,{label:"性别"},{default:g((()=>[C(fe,{modelValue:_(s).gender,"onUpdate:modelValue":d[7]||(d[7]=e=>_(s).gender=e),code:"gender"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])):A("",!0),"password"===_(l).type?(f(),v(ve,{key:1,ref:"passwordChangeFormRef",model:_(r),rules:c,"label-width":100},{default:g((()=>[C(pe,{label:"原密码",prop:"oldPassword"},{default:g((()=>[C(ce,{modelValue:_(r).oldPassword,"onUpdate:modelValue":d[8]||(d[8]=e=>_(r).oldPassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1}),C(pe,{label:"新密码",prop:"newPassword"},{default:g((()=>[C(ce,{modelValue:_(r).newPassword,"onUpdate:modelValue":d[9]||(d[9]=e=>_(r).newPassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1}),C(pe,{label:"确认密码",prop:"confirmPassword"},{default:g((()=>[C(ce,{modelValue:_(r).confirmPassword,"onUpdate:modelValue":d[10]||(d[10]=e=>_(r).confirmPassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])):"mobile"===_(l).type?(f(),v(ve,{key:2,ref:"mobileBindingFormRef",model:_(t),rules:b,"label-width":100},{default:g((()=>[C(pe,{label:"手机号码",prop:"mobile"},{default:g((()=>[C(ce,{modelValue:_(t).mobile,"onUpdate:modelValue":d[11]||(d[11]=e=>_(t).mobile=e),style:{width:"250px"}},null,8,["modelValue"])])),_:1}),C(pe,{label:"验证码",prop:"code"},{default:g((()=>[C(ce,{modelValue:_(t).code,"onUpdate:modelValue":d[12]||(d[12]=e=>_(t).code=e),style:{width:"250px"}},{append:g((()=>[C(m,{disabled:_(o)>0,onClick:j},{default:g((()=>[I(q(_(o)>0?`${_(o)}s后重新发送`:"发送验证码"),1)])),_:1},8,["disabled"])])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])):"email"===_(l).type?(f(),v(ve,{key:3,ref:"emailBindingFormRef",model:_(i),rules:y,"label-width":100},{default:g((()=>[C(pe,{label:"邮箱",prop:"email"},{default:g((()=>[C(ce,{modelValue:_(i).email,"onUpdate:modelValue":d[13]||(d[13]=e=>_(i).email=e),style:{width:"250px"}},null,8,["modelValue"])])),_:1}),C(pe,{label:"验证码",prop:"code"},{default:g((()=>[C(ce,{modelValue:_(i).code,"onUpdate:modelValue":d[14]||(d[14]=e=>_(i).code=e),style:{width:"250px"}},{append:g((()=>[C(m,{disabled:_(u)>0,onClick:h},{default:g((()=>[I(q(_(u)>0?`${_(u)}s后重新发送`:"发送验证码"),1)])),_:1},8,["disabled"])])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])):A("",!0)])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-249ac15d"]]);export{oe as default};
